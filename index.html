<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Acceso Seguro</title>
  <script>
    // URL de tu Google Apps Script (actualizada)
    const googleScriptURL = "https://script.google.com/macros/s/AKfycbzWUDe4c_IQPQPjz5togLqfJCfhhzfbGhhFzs0nxGWUC9ySvUi_ThKTAGZlz_sD1Ao4oA/exec";
    
    // Exponemos la función de validación al ámbito global (window)
    window.validarAcceso = function() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      console.log("validarAcceso ejecutada:", email, password);
      
      // Realizamos la solicitud fetch usando "application/x-www-form-urlencoded"
      fetch(googleScriptURL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ email: email, password: password })
      })
      .then(response => response.text())
      .then(data => {
          console.log("Respuesta recibida:", data);
          // Mostramos el resultado en el elemento con id "status"
          document.getElementById("status").innerText = data;
          // Si la respuesta contiene "Bienvenido", se asume acceso exitoso
          if (data.includes("Bienvenido")) {
              localStorage.setItem("usuarioAutenticado", "true");
              // Redirige al visor; modifica "visor.html" según corresponda
              window.location.href = "visor.html";
          }
      })
      .catch(error => {
          console.error("Error de conexión:", error);
          document.getElementById("status").innerText = "Error de conexión.";
      });
    }
  </script>
</head>
<body>
  <h2>Ingrese su Correo y Clave</h2>
  <input type="email" id="email" placeholder="Ingrese su correo"><br><br>
  <input type="password" id="password" placeholder="Clave de acceso"><br><br>
  <!-- El atributo onclick llamará a la función validarAcceso, que ya está en el ámbito global -->
  <button onclick="validarAcceso()">Ingresar</button>
  
  <p id="status"></p>
</body>
</html>
